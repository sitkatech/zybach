version: '3.7'

services:
  zybach.api:
    image: zybach/api
    labels:
      - "com.microsoft.visualstudio.targetoperatingsystem=linux"
    build:
      args:
        source: ${DOCKER_BUILD_SOURCE}
    ports:
      - "8711:80"
      - "8712:443"
    environment:
      - ASPNETCORE_URLS=https://+:443;http://+:80
      - ASPNETCORE_HTTPS_PORT=8712
      - Kestrel__Certificates__Default__Path=/https/host.docker.internal.pfx
      - Kestrel__Certificates__Default__Password=password#1
    volumes:
      - ~/.aspnet/https:/https:ro

  sitkacapture:
    container_name: zybach_sitkacapture
    image: sitkacontainers.azurecr.io/sitkacapture:latest
    environment:
      - PORT=8724
    ports:
      - 127.0.0.1:8724:8724
